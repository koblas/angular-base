(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var app;

app = angular.module('geartrackerApp', ['restangular', 'ui.router', 'ngCookies']);

require('./services/auth');

require('./controllers/main');

require('./controllers/todo');

require('./controllers/auth');

app.config(function(RestangularProvider, $stateProvider, $urlRouterProvider) {
  RestangularProvider.setBaseUrl('/api/v1');
  RestangularProvider.setResponseExtractor(function(response, operation, what, url) {
    var newResponse;
    if (operation === "getList") {
      return newResponse = response.data;
    } else {
      return newResponse = response.data;
    }
  });
  return $urlRouterProvider.otherwise("/");
});

app.run(function($rootScope, $state, $location, AuthService) {
  return $rootScope.$on("$stateChangeStart", function(event, toState, toParams, fromState, fromParams) {
    var href;
    if (toState.authenticate && !AuthService.isAuthenticated()) {
      href = $state.href(toState, toParams);
      $state.transitionTo("login", {
        next: $location.path()
      });
      return event.preventDefault();
    }
  });
});


},{"./controllers/auth":2,"./controllers/main":3,"./controllers/todo":4,"./services/auth":5}],2:[function(require,module,exports){
var app;

app = angular.module('geartrackerApp');

app.config(function($stateProvider) {
  return $stateProvider.state('auth', {
    abstract: true,
    url: "/auth",
    template: '<ui-view/>'
  }).state('auth.register', {
    url: "/register?next",
    templateUrl: "/static/partials/auth/register.html",
    controller: "RegisterController",
    authenticate: false
  }).state('auth.login', {
    url: "/login?next",
    templateUrl: "/static/partials/auth/login.html",
    controller: "LoginController",
    authenticate: false
  }).state('auth.logout', {
    url: "/logout",
    templateUrl: "/static/partials/logout.html",
    controller: "LogoutController",
    authenticate: false
  });
});

app.controller('LoginController', function($scope, $location, AuthService, $stateParams) {
  var _ref;
  $scope.email = "";
  $scope.error = "";
  $scope.next = ((_ref = $stateParams.params) != null ? _ref.next : void 0) || '/';
  return $scope.login = function() {
    if (!$scope.email) {
      $scope.error = "Invalid Email Address";
      return;
    }
    if (!$scope.password) {
      $scope.error = "Invalid Password";
      return;
    }
    return AuthService.login($scope.email, $scope.password).then(function() {
      return $location.path($scope.next);
    })["catch"](function(err) {
      return console.log("Auth Error", err);
    });
  };
});

app.controller('RegisterController', function($scope, $location, AuthService, $stateParams) {
  var _ref;
  $scope.password = "";
  $scope.username = "";
  $scope.email = "";
  $scope.error = "";
  $scope.next = ((_ref = $stateParams.params) != null ? _ref.next : void 0) || '/';
  return $scope.register = function() {
    if (!$scope.email) {
      $scope.error = "Invalid Email Address";
      return;
    }
    if (!$scope.username) {
      $scope.error = "Invalid Username";
      return;
    }
    if (!$scope.password) {
      $scope.error = "Invalid Password";
      return;
    }
    return AuthService.register($scope.email, $scope.password, {
      username: $scope.username
    }).then(function() {
      return $location.path($scope.next);
    })["catch"](function(err) {
      return $scope.error = err;
    });
  };
});


},{}],3:[function(require,module,exports){
var app;

app = angular.module('geartrackerApp');

app.config(function($stateProvider) {
  $stateProvider.state('index_', {
    url: '',
    templateUrl: '/static/partials/index.html',
    controller: "IndexController",
    authenticate: false
  });
  return $stateProvider.state('index', {
    url: '/',
    templateUrl: '/static/partials/index.html',
    controller: "IndexController",
    authenticate: false
  });
});

app.controller('IndexController', function($scope, $state, AuthService) {
  if (AuthService.isAuthenticated()) {
    return $state.go('dashboard');
  }
});

app.controller('MainController', function($scope, AuthService, $location) {
  $scope.auth = AuthService;
  return $scope.logout = function() {
    AuthService.logout();
    return $location.path('/');
  };
});


},{}],4:[function(require,module,exports){
var app;

app = angular.module('geartrackerApp');

app.config(function($stateProvider) {
  return $stateProvider.state('dashboard', {
    url: '/dash',
    templateUrl: '/static/partials/dashboard.html',
    controller: "DashboardController",
    authenticate: true
  }).state('todo', {
    url: '/todo',
    templateUrl: '/static/partials/todo.html',
    controller: "TodoController",
    authenticate: true
  });
});

app.controller('DashboardController', function($scope, Restangular) {
  return true;
});

app.controller('TodoController', function($scope, Restangular) {
  var Todo;
  $scope.todos = [];
  $scope.loaded = false;
  Todo = Restangular.all('todo');
  Todo.getList().then(function(todos) {
    $scope.loaded = true;
    return $scope.todos = todos;
  });
  $scope.addTodo = function(title) {
    if (title) {
      return Todo.post({
        'title': title
      }).then(function(todo) {
        $scope.newTodoTitle = '';
        if (todo) {
          return $scope.todos.push(todo);
        }
      }, function(err) {
        return alert(err.data.message || "an error occurred");
      });
    }
  };
  $scope.changeCompleted = function(todo) {
    return todo.put().then(null, function(err) {
      return alert(err.data.message || (err.errors && err.errors.completed) || "an error occurred");
    });
  };
  return $scope.removeCompletedItems = function() {
    return $scope.todos.forEach(function(todo) {
      if (!todo.completed) {
        return;
      }
      return todo.remove().then(function() {
        return $scope.todos = _.without($scope.todos, todo);
      }, function(err) {
        return alert(err.data.message || (err.errors && err.errors.completed) || "an error occurred");
      });
    });
  };
});


},{}],5:[function(require,module,exports){
var app;

app = angular.module('geartrackerApp');

app.service('AuthService', function(Restangular, $q, $cookies, $state) {
  var Auth, auth_cookie, self;
  Auth = Restangular.all('auth');
  auth_cookie = 'user_auth';
  self = this;
  self.authenticated = false;
  self.name = null;
  if ($cookies[auth_cookie]) {
    this.authenticated = true;
    Auth.post({
      token: $cookies[auth_cookie]
    }).then(function(auth) {
      if (auth && auth.token) {
        return Restangular.setDefaultHeaders({
          Authorization: 'Basic ' + auth.token
        });
      } else {
        delete $cookies[auth_cookie];
        self.authenticated = false;
        return $state.transitionTo("index");
      }
    });
  }
  return {
    isAuthenticated: function() {
      return self.authenticated;
    },
    login: function(email, password) {
      var deferred;
      deferred = $q.defer();
      Auth.post({
        email: email,
        password: password
      }).then(function(auth) {
        if (auth.token) {
          self.authenticated = true;
          $cookies[auth_cookie] = auth.token;
          Restangular.setDefaultHeaders({
            Authorization: 'Basic ' + auth.token
          });
          return deferred.resolve("ok");
        } else {
          return deferred.reject("unknown");
        }
      }, function(err) {
        return deferred.reject(err.data.emsg);
      });
      return deferred.promise;
    },
    logout: function() {
      self.authenticated = false;
      delete $cookies[auth_cookie];
      return Restangular.setDefaultHeaders({
        Authorization: 'Basic ' + 'INVALID'
      });
    },
    register: function(email, password, params) {
      var deferred;
      deferred = $q.defer();
      Auth.post({
        email: email,
        password: password,
        params: params
      }, {
        register: true
      }).then(function(auth) {
        if (auth.token) {
          self.authenticated = true;
          $cookies[auth_cookie] = auth.token;
          Restangular.setDefaultHeaders({
            Authorization: 'Basic ' + auth.token
          });
          return deferred.resolve("ok");
        } else {
          return deferred.reject("unknown");
        }
      }, function(err) {
        return deferred.reject(err.data.emsg);
      });
      return deferred.promise;
    }
  };
});


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMva29ibGFzL3JlcG9zL2VkaXQvbm9kZV9tb2R1bGVzL2dydW50LWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9rb2JsYXMvcmVwb3MvZWRpdC9jbGllbnQvYXBwL2FwcC5jb2ZmZWUiLCIvVXNlcnMva29ibGFzL3JlcG9zL2VkaXQvY2xpZW50L2FwcC9jb250cm9sbGVycy9hdXRoLmNvZmZlZSIsIi9Vc2Vycy9rb2JsYXMvcmVwb3MvZWRpdC9jbGllbnQvYXBwL2NvbnRyb2xsZXJzL21haW4uY29mZmVlIiwiL1VzZXJzL2tvYmxhcy9yZXBvcy9lZGl0L2NsaWVudC9hcHAvY29udHJvbGxlcnMvdG9kby5jb2ZmZWUiLCIvVXNlcnMva29ibGFzL3JlcG9zL2VkaXQvY2xpZW50L2FwcC9zZXJ2aWNlcy9hdXRoLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLElBQUEsR0FBQTs7QUFBQSxHQUFBLEdBQU0sT0FBTyxDQUFDLE1BQVIsQ0FBZSxnQkFBZixFQUFpQyxDQUFDLGFBQUQsRUFBZ0IsV0FBaEIsRUFBNkIsV0FBN0IsQ0FBakMsQ0FBTixDQUFBOztBQUFBLE9BRUEsQ0FBUSxpQkFBUixDQUZBLENBQUE7O0FBQUEsT0FHQSxDQUFRLG9CQUFSLENBSEEsQ0FBQTs7QUFBQSxPQUlBLENBQVEsb0JBQVIsQ0FKQSxDQUFBOztBQUFBLE9BS0EsQ0FBUSxvQkFBUixDQUxBLENBQUE7O0FBQUEsR0FPRyxDQUFDLE1BQUosQ0FBVyxTQUFDLG1CQUFELEVBQXNCLGNBQXRCLEVBQXNDLGtCQUF0QyxHQUFBO0FBQ1AsRUFBQSxtQkFBbUIsQ0FBQyxVQUFwQixDQUErQixTQUEvQixDQUFBLENBQUE7QUFBQSxFQUVBLG1CQUFtQixDQUFDLG9CQUFwQixDQUF5QyxTQUFDLFFBQUQsRUFBVyxTQUFY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Q0FBVTtBQUFBLFFBQUMsS0FBQSxFQUFNLEtBQVA7QUFBQSxRQUFjLFFBQUEsRUFBUyxRQUF2QjtBQUFBLFFBQWlDLE1BQUEsRUFBTyxNQUF4QztPQUFWLEVBQTJEO0FBQUEsUUFBQyxRQUFBLEVBQVMsSUFBVjtPQUEzRCxDQUEyRSxDQUFDLElBQTVFLENBQWlGLFNBQUMsSUFBRCxHQUFBO0FBQzdFLFFBQUEsSUFBRyxJQUFJLENBQUMsS0FBUjtBQUNJLFVBQUEsSUFBSSxDQUFDLGFBQUwsR0FBcUIsSUFBckIsQ0FBQTtBQUFBLFVBRUEsUUFBUyxDQUFBLFdBQUEsQ0FBVCxHQUF3QixJQUFJLENBQUMsS0FGN0IsQ0FBQTtBQUFBLFVBR0EsV0FBVyxDQUFDLGlCQUFaLENBQThCO0FBQUEsWUFBQyxhQUFBLEVBQWUsUUFBQSxHQUFXLElBQUksQ0FBQyxLQUFoQztXQUE5QixDQUhBLENBQUE7aUJBSUEsUUFBUSxDQUFDLE9BQVQsQ0FBaUIsSUFBakIsRUFMSjtTQUFBLE1BQUE7aUJBT0ksUUFBUSxDQUFDLE1BQVQsQ0FBZ0IsU0FBaEIsRUFQSjtTQUQ2RTtNQUFBLENBQWpGLEVBU0UsU0FBQyxHQUFELEdBQUE7ZUFDRSxRQUFRLENBQUMsTUFBVCxDQUFnQixHQUFHLENBQUMsSUFBSSxDQUFDLElBQXpCLEVBREY7TUFBQSxDQVRGLENBRkEsQ0FBQTthQWNBLFFBQVEsQ0FBQyxRQWZIO0lBQUEsQ0EvQlA7R0FBUCxDQXhCdUI7QUFBQSxDQUEzQixDQUZBLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImFwcCA9IGFuZ3VsYXIubW9kdWxlICdnZWFydHJhY2tlckFwcCcsIFsncmVzdGFuZ3VsYXInLCAndWkucm91dGVyJywgJ25nQ29va2llcyddXG5cbnJlcXVpcmUoJy4vc2VydmljZXMvYXV0aCcpXG5yZXF1aXJlKCcuL2NvbnRyb2xsZXJzL21haW4nKVxucmVxdWlyZSgnLi9jb250cm9sbGVycy90b2RvJylcbnJlcXVpcmUoJy4vY29udHJvbGxlcnMvYXV0aCcpXG5cbmFwcC5jb25maWcgKFJlc3Rhbmd1bGFyUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIC0+XG4gICAgUmVzdGFuZ3VsYXJQcm92aWRlci5zZXRCYXNlVXJsKCcvYXBpL3YxJylcblxuICAgIFJlc3Rhbmd1bGFyUHJvdmlkZXIuc2V0UmVzcG9uc2VFeHRyYWN0b3IgKHJlc3BvbnNlLCBvcGVyYXRpb24sIHdoYXQsIHVybCkgLT5cbiAgICAgICAgICAgICMgIFRoaXMgaXMgYSBnZXQgZm9yIGEgbGlzdFxuICAgICAgICAgICAgaWYgb3BlcmF0aW9uIGlzIFwiZ2V0TGlzdFwiIFxuICAgICAgICAgICAgICAgICMgIEhlcmUgd2UncmUgcmV0dXJuaW5nIGFuIEFycmF5IHdoaWNoIGhhcyBvbmUgc3BlY2lhbCBwcm9wZXJ0eSBtZXRhZGF0YSB3aXRoIG91ciBleHRyYSBpbmZvcm1hdGlvblxuICAgICAgICAgICAgICAgIG5ld1Jlc3BvbnNlID0gcmVzcG9uc2UuZGF0YVxuICAgICAgICAgICAgZWxzZSBcbiAgICAgICAgICAgICAgICAjICBUaGlzIGlzIGFuIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBuZXdSZXNwb25zZSA9IHJlc3BvbnNlLmRhdGFcblxuICAgICMgIFVubWF0Y2hlZCBVUkwgc3RhdGVcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKVxuXG5hcHAucnVuICgkcm9vdFNjb3BlLCAkc3RhdGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIC0+XG4gICAgJHJvb3RTY29wZS4kb24gXCIkc3RhdGVDaGFuZ2VTdGFydFwiLCAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIC0+XG4gICAgICAgIGlmIHRvU3RhdGUuYXV0aGVudGljYXRlICYmICFBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKVxuICAgICAgICAgICAgIyAgVXNlciBpc27igJl0IGF1dGhlbnRpY2F0ZWRcbiAgICAgICAgICAgIGhyZWYgPSAkc3RhdGUuaHJlZih0b1N0YXRlLCB0b1BhcmFtcylcbiAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oXCJsb2dpblwiLCB7IG5leHQ6ICRsb2NhdGlvbi5wYXRoKCkgfSlcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4iLCJhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ2VhcnRyYWNrZXJBcHAnKVxuXG5hcHAuY29uZmlnICgkc3RhdGVQcm92aWRlcikgLT5cbiAgICAjICBTdGF0ZXNcbiAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAuc3RhdGUoJ2F1dGgnLCB7XG4gICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgIHVybDogXCIvYXV0aFwiLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8dWktdmlldy8+J1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2F1dGgucmVnaXN0ZXInLCB7XG4gICAgICAgICAgICB1cmw6IFwiL3JlZ2lzdGVyP25leHRcIixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvYXV0aC9yZWdpc3Rlci5odG1sXCIsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBcIlJlZ2lzdGVyQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgYXV0aGVudGljYXRlOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2F1dGgubG9naW4nLCB7XG4gICAgICAgICAgICB1cmw6IFwiL2xvZ2luP25leHRcIixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvYXV0aC9sb2dpbi5odG1sXCIsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBcIkxvZ2luQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgYXV0aGVudGljYXRlOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2F1dGgubG9nb3V0Jywge1xuICAgICAgICAgICAgdXJsOiBcIi9sb2dvdXRcIixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvbG9nb3V0Lmh0bWxcIixcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTG9nb3V0Q29udHJvbGxlclwiLFxuICAgICAgICAgICAgYXV0aGVudGljYXRlOiBmYWxzZVxuICAgICAgICB9KVxuXG5hcHAuY29udHJvbGxlciAnTG9naW5Db250cm9sbGVyJywgKCRzY29wZSwgJGxvY2F0aW9uLCAgQXV0aFNlcnZpY2UsICRzdGF0ZVBhcmFtcykgLT5cbiAgICAkc2NvcGUuZW1haWwgPSBcIlwiXG4gICAgJHNjb3BlLmVycm9yID0gXCJcIlxuICAgICRzY29wZS5uZXh0ICA9ICRzdGF0ZVBhcmFtcy5wYXJhbXM/Lm5leHQgfHwgJy8nXG5cbiAgICAkc2NvcGUubG9naW4gPSAoKSAtPlxuICAgICAgICBpZiAhJHNjb3BlLmVtYWlsXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkludmFsaWQgRW1haWwgQWRkcmVzc1wiXG4gICAgICAgICAgICByZXR1cm5cblxuICAgICAgICBpZiAhJHNjb3BlLnBhc3N3b3JkXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkludmFsaWQgUGFzc3dvcmRcIlxuICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgQXV0aFNlcnZpY2UubG9naW4oJHNjb3BlLmVtYWlsLCAkc2NvcGUucGFzc3dvcmQpXG4gICAgICAgICAgICAudGhlbiAoKSAtPiAkbG9jYXRpb24ucGF0aCgkc2NvcGUubmV4dClcbiAgICAgICAgICAgIC5jYXRjaCAoZXJyKSAtPiBjb25zb2xlLmxvZyhcIkF1dGggRXJyb3JcIiwgZXJyKVxuXG5hcHAuY29udHJvbGxlciAnUmVnaXN0ZXJDb250cm9sbGVyJywgKCRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSwgJHN0YXRlUGFyYW1zKSAtPlxuICAgICRzY29wZS5wYXNzd29yZCA9IFwiXCJcbiAgICAkc2NvcGUudXNlcm5hbWUgPSBcIlwiXG4gICAgJHNjb3BlLmVtYWlsID0gXCJcIlxuICAgICRzY29wZS5lcnJvciA9IFwiXCJcbiAgICAkc2NvcGUubmV4dCAgPSAkc3RhdGVQYXJhbXMucGFyYW1zPy5uZXh0IHx8ICcvJ1xuXG4gICAgJHNjb3BlLnJlZ2lzdGVyID0gKCkgLT5cbiAgICAgICAgaWYgISRzY29wZS5lbWFpbFxuICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJJbnZhbGlkIEVtYWlsIEFkZHJlc3NcIlxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIGlmICEkc2NvcGUudXNlcm5hbWVcbiAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiSW52YWxpZCBVc2VybmFtZVwiXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgaWYgISRzY29wZS5wYXNzd29yZFxuICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJJbnZhbGlkIFBhc3N3b3JkXCJcbiAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgIEF1dGhTZXJ2aWNlLnJlZ2lzdGVyKCRzY29wZS5lbWFpbCwgJHNjb3BlLnBhc3N3b3JkLCB7IHVzZXJuYW1lOiAkc2NvcGUudXNlcm5hbWUgfSlcbiAgICAgICAgICAgIC50aGVuICgpIC0+ICRsb2NhdGlvbi5wYXRoKCRzY29wZS5uZXh0KVxuICAgICAgICAgICAgLmNhdGNoIChlcnIpIC0+ICRzY29wZS5lcnJvciA9IGVyclxuIiwiYXBwID0gYW5ndWxhci5tb2R1bGUoJ2dlYXJ0cmFja2VyQXBwJyk7XG5cbmFwcC5jb25maWcgKCRzdGF0ZVByb3ZpZGVyKSAtPlxuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnaW5kZXhfJywge1xuICAgICAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3N0YXRpYy9wYXJ0aWFscy9pbmRleC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiSW5kZXhDb250cm9sbGVyXCIsXG4gICAgICAgICAgICBhdXRoZW50aWNhdGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnaW5kZXgnLCB7XG4gICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3N0YXRpYy9wYXJ0aWFscy9pbmRleC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiSW5kZXhDb250cm9sbGVyXCIsXG4gICAgICAgICAgICBhdXRoZW50aWNhdGU6IGZhbHNlLFxuICAgICAgICB9KTtcblxuYXBwLmNvbnRyb2xsZXIgJ0luZGV4Q29udHJvbGxlcicsICgkc2NvcGUsICRzdGF0ZSwgQXV0aFNlcnZpY2UpIC0+XG4gICAgaWYgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKClcbiAgICAgICAgJHN0YXRlLmdvKCdkYXNoYm9hcmQnKVxuXG5hcHAuY29udHJvbGxlciAnTWFpbkNvbnRyb2xsZXInLCAoJHNjb3BlLCBBdXRoU2VydmljZSwgJGxvY2F0aW9uKSAtPlxuICAgICRzY29wZS5hdXRoID0gQXV0aFNlcnZpY2U7XG4gICAgJHNjb3BlLmxvZ291dCA9ICgpIC0+XG4gICAgICAgIEF1dGhTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuIiwiYXBwID0gYW5ndWxhci5tb2R1bGUoJ2dlYXJ0cmFja2VyQXBwJyk7XG5cbmFwcC5jb25maWcgKCRzdGF0ZVByb3ZpZGVyKSAtPlxuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnZGFzaGJvYXJkJywge1xuICAgICAgICAgICAgdXJsOiAnL2Rhc2gnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvc3RhdGljL3BhcnRpYWxzL2Rhc2hib2FyZC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiRGFzaGJvYXJkQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgYXV0aGVudGljYXRlOiB0cnVlXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgndG9kbycsIHtcbiAgICAgICAgICAgIHVybDogJy90b2RvJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3N0YXRpYy9wYXJ0aWFscy90b2RvLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogXCJUb2RvQ29udHJvbGxlclwiLFxuICAgICAgICAgICAgYXV0aGVudGljYXRlOiB0cnVlXG4gICAgICAgIH0pO1xuXG5hcHAuY29udHJvbGxlciAnRGFzaGJvYXJkQ29udHJvbGxlcicsICgkc2NvcGUsIFJlc3Rhbmd1bGFyKSAtPiB0cnVlXG5cbmFwcC5jb250cm9sbGVyICdUb2RvQ29udHJvbGxlcicsICgkc2NvcGUsIFJlc3Rhbmd1bGFyKSAtPlxuICAgICRzY29wZS50b2RvcyA9IFtdO1xuICAgICRzY29wZS5sb2FkZWQgPSBmYWxzZTtcblxuICAgIFRvZG8gPSBSZXN0YW5ndWxhci5hbGwoJ3RvZG8nKVxuXG4gICAgVG9kby5nZXRMaXN0KCkudGhlbihcbiAgICAgICAgKHRvZG9zKSAtPlxuICAgICAgICAgICAgJHNjb3BlLmxvYWRlZCA9IHRydWVcbiAgICAgICAgICAgICRzY29wZS50b2RvcyA9IHRvZG9zXG4gICAgKVxuXG4gICAgJHNjb3BlLmFkZFRvZG8gPSAodGl0bGUpIC0+XG4gICAgICAgICAgICBpZiAodGl0bGUpXG4gICAgICAgICAgICAgICAgVG9kby5wb3N0KHsndGl0bGUnOiB0aXRsZSB9KS50aGVuKFxuICAgICAgICAgICAgICAgICAgICAodG9kbykgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5uZXdUb2RvVGl0bGUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2RvKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50b2Rvcy5wdXNoKHRvZG8pO1xuICAgICAgICAgICAgICAgICAgICAsIChlcnIpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxlcnQoZXJyLmRhdGEubWVzc2FnZSB8fCBcImFuIGVycm9yIG9jY3VycmVkXCIpO1xuICAgICAgICAgICAgICAgIClcblxuICAgICRzY29wZS5jaGFuZ2VDb21wbGV0ZWQgPSAodG9kbykgLT5cbiAgICAgICAgdG9kby5wdXQoKS50aGVuKG51bGwsIChlcnIpIC0+XG4gICAgICAgICAgICByZXR1cm4gYWxlcnQoZXJyLmRhdGEubWVzc2FnZSB8fCAoZXJyLmVycm9ycyAmJiBlcnIuZXJyb3JzLmNvbXBsZXRlZCkgfHwgXCJhbiBlcnJvciBvY2N1cnJlZFwiKTtcbiAgICAgICAgKVxuXG4gICAgJHNjb3BlLnJlbW92ZUNvbXBsZXRlZEl0ZW1zID0gKCkgLT5cbiAgICAgICAgJHNjb3BlLnRvZG9zLmZvckVhY2goKHRvZG8pIC0+XG4gICAgICAgICAgICBpZiAoIXRvZG8uY29tcGxldGVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgdG9kby5yZW1vdmUoKS50aGVuKCgpIC0+XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRvZG9zID0gXy53aXRob3V0KCRzY29wZS50b2RvcywgdG9kbyk7XG4gICAgICAgICAgICAsIChlcnIpIC0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFsZXJ0KGVyci5kYXRhLm1lc3NhZ2UgfHwgKGVyci5lcnJvcnMgJiYgZXJyLmVycm9ycy5jb21wbGV0ZWQpIHx8IFwiYW4gZXJyb3Igb2NjdXJyZWRcIik7XG4gICAgICAgICAgICApXG4gICAgICAgIClcbiIsImFwcCA9IGFuZ3VsYXIubW9kdWxlKCdnZWFydHJhY2tlckFwcCcpXG5cbmFwcC5zZXJ2aWNlICdBdXRoU2VydmljZScsIChSZXN0YW5ndWxhciwgJHEsICRjb29raWVzLCAkc3RhdGUpIC0+XG4gICAgQXV0aCA9IFJlc3Rhbmd1bGFyLmFsbCgnYXV0aCcpXG4gICAgYXV0aF9jb29raWUgPSAndXNlcl9hdXRoJ1xuICAgIHNlbGYgPSB0aGlzXG4gICAgXG4gICAgc2VsZi5hdXRoZW50aWNhdGVkID0gZmFsc2VcbiAgICBzZWxmLm5hbWUgPSBudWxsXG5cbiAgICAjXG4gICAgIyAgSWYgdGhlIGF1dGggY29va2llIGlzIGFyb3VuZCAtIHVzZSBpdFxuICAgICNcbiAgICBpZiAoJGNvb2tpZXNbYXV0aF9jb29raWVdKSBcbiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gdHJ1ZVxuXG4gICAgICAgIEF1dGgucG9zdCh7dG9rZW46JGNvb2tpZXNbYXV0aF9jb29raWVdfSkudGhlbiAoYXV0aCkgLT5cbiAgICAgICAgICAgIGlmIChhdXRoICYmIGF1dGgudG9rZW4pIFxuICAgICAgICAgICAgICAgICMgIFRva2VuIGlzIGdvb2QsIHNldCB0aGUgYXV0aGVudGljYXRpb24gaGVhZGVyc1xuICAgICAgICAgICAgICAgIFJlc3Rhbmd1bGFyLnNldERlZmF1bHRIZWFkZXJzKHtBdXRob3JpemF0aW9uOiAnQmFzaWMgJyArIGF1dGgudG9rZW59KVxuICAgICAgICAgICAgZWxzZSBcbiAgICAgICAgICAgICAgICAjICBJZiB0aGUgdG9rZW4gaXMgXCJiYWRcIiBlLmcuIHlvdSdyZSBubyBsb25nZXIgYSB2YWxpZCB1c2VyLCBjbGVhbnVwXG4gICAgICAgICAgICAgICAgZGVsZXRlICRjb29raWVzW2F1dGhfY29va2llXVxuICAgICAgICAgICAgICAgIHNlbGYuYXV0aGVudGljYXRlZCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbyhcImluZGV4XCIpXG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6ICgpIC0+IHNlbGYuYXV0aGVudGljYXRlZFxuXG4gICAgICAgICNcbiAgICAgICAgIyAgTG9naW4gYSB1c2VyIGJ5IGVtYWlsICsgcGFzc3dvcmQgLSByZXR1cm4gYSBwcm9taXNlXG4gICAgICAgICMgXG4gICAgICAgICMgIFRPRE8gLSBiZXR0ZXIgZXJyb3IgbWVzc2FnZXMgb24gdGhlIHJlc3VsdFxuICAgICAgICAjXG4gICAgICAgIGxvZ2luOiAoZW1haWwsIHBhc3N3b3JkKSAtPlxuICAgICAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpXG5cbiAgICAgICAgICAgIEF1dGgucG9zdCh7ZW1haWw6ZW1haWwsIHBhc3N3b3JkOnBhc3N3b3JkfSkudGhlbiAoYXV0aCkgLT5cbiAgICAgICAgICAgICAgICBpZiBhdXRoLnRva2VuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYXV0aGVudGljYXRlZCA9IHRydWVcblxuICAgICAgICAgICAgICAgICAgICAkY29va2llc1thdXRoX2Nvb2tpZV0gPSBhdXRoLnRva2VuXG4gICAgICAgICAgICAgICAgICAgIFJlc3Rhbmd1bGFyLnNldERlZmF1bHRIZWFkZXJzKHtBdXRob3JpemF0aW9uOiAnQmFzaWMgJyArIGF1dGgudG9rZW59KVxuXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoXCJva1wiKVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KFwidW5rbm93blwiKVxuICAgICAgICAgICAgLCAoZXJyKSAtPlxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIuZGF0YS5lbXNnKVxuXG4gICAgICAgICAgICBkZWZlcnJlZC5wcm9taXNlXG5cbiAgICAgICAgbG9nb3V0OiAoKSAtPlxuICAgICAgICAgICAgc2VsZi5hdXRoZW50aWNhdGVkID0gZmFsc2VcbiAgICAgICAgICAgIGRlbGV0ZSAkY29va2llc1thdXRoX2Nvb2tpZV1cbiAgICAgICAgICAgIFJlc3Rhbmd1bGFyLnNldERlZmF1bHRIZWFkZXJzKHtBdXRob3JpemF0aW9uOiAnQmFzaWMgJyArICdJTlZBTElEJ30pXG5cbiAgICAgICAgcmVnaXN0ZXI6IChlbWFpbCwgcGFzc3dvcmQsIHBhcmFtcykgLT5cbiAgICAgICAgICAgIGRlZmVycmVkID0gJHEuZGVmZXIoKVxuXG4gICAgICAgICAgICBBdXRoLnBvc3Qoe2VtYWlsOmVtYWlsLCBwYXNzd29yZDpwYXNzd29yZCwgcGFyYW1zOnBhcmFtc30sIHtyZWdpc3Rlcjp0cnVlfSkudGhlbiAoYXV0aCkgLT5cbiAgICAgICAgICAgICAgICBpZiBhdXRoLnRva2VuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYXV0aGVudGljYXRlZCA9IHRydWVcblxuICAgICAgICAgICAgICAgICAgICAkY29va2llc1thdXRoX2Nvb2tpZV0gPSBhdXRoLnRva2VuXG4gICAgICAgICAgICAgICAgICAgIFJlc3Rhbmd1bGFyLnNldERlZmF1bHRIZWFkZXJzKHtBdXRob3JpemF0aW9uOiAnQmFzaWMgJyArIGF1dGgudG9rZW59KVxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKFwib2tcIilcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChcInVua25vd25cIilcbiAgICAgICAgICAgICwgKGVycikgLT5cbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyLmRhdGEuZW1zZylcblxuICAgICAgICAgICAgZGVmZXJyZWQucHJvbWlzZVxuICAgIH1cbiJdfQ==
